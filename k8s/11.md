# Lab 11

## Create and Decode Secret

```bash
$ kubectl create secret generic mysecret --from-literal=password=super_pass123
secret/mysecret created
```

```bash
$ kubectl get secrets
NAME       TYPE     DATA   AGE
mysecret   Opaque   1      21s
```

```bash
$ kubectl describe secret mysecret
Name:         mysecret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  13 bytes
$ kubectl get secret mypass -o jsonpath='{.data.password}' | base64 --decode
super_pass123
```

## Print Secrets

```bash
$ kubectl get po
NAME                                        READY   STATUS    RESTARTS   AGE
chart-1773277380-helm-app-4ec3387356-lm7x7  1/1     Running   0          49s
$ kubectl exec chart-1773277380-helm-app-4ec3387356-lm7x7 -- printenv | grep MY_SECRET
MY_SECRET=super_pass123
```

## Vault

```bash
$ kubectl get pods -n default
NAMESPACE     NAME                                    READY   STATUS    RESTARTS        AGE
default       vault-0                                 1/1     Running   0               2m34s
default       vault-agent-injector-4de7a4e12z-jljqa   1/1     Running   0               2m34s
```

## Creating Secrets

```bash
$ kubectl exec -it vault-0 -- /bin/sh
$ vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
$ vault kv put internal/database/config username="db-readonly-username" password="db-secret-password"
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2023-11-23T19:30:29.884562556Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
$ vault kv get internal/database/config
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2023-11-23T19:30:29.884562556Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
password    db-secret-password
username    db-readonly-username
```

```bash
$ kubectl get sa -n default
NAME                   SECRETS   AGE
default                0         59m
vault                  0         53m
vault-agent-injector   0         53m
helm-app               0         8m23s
```
